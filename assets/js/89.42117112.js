(window.webpackJsonp=window.webpackJsonp||[]).push([[89],{404:function(a,e,t){"use strict";t.r(e);var s=t(27),r=Object(s.a)({},(function(){var a=this,e=a._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h1",{attrs:{id:"secure-boot-key-generation-and-handling"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#secure-boot-key-generation-and-handling"}},[a._v("#")]),a._v(" Secure Boot Key Generation and Handling")]),a._v(" "),e("h2",{attrs:{id:"owernship"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#owernship"}},[a._v("#")]),a._v(" Owernship")]),a._v(" "),e("p",[a._v("Certificate and key generation and handling is overseen by ALESCo.")]),a._v(" "),e("h2",{attrs:{id:"key-generation"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#key-generation"}},[a._v("#")]),a._v(" Key Generation")]),a._v(" "),e("p",[a._v("This is a slow and tedious process. It is important that no corners are cut and the utmost care is taken validating security through every step of the process.")]),a._v(" "),e("h3",{attrs:{id:"prepare-a-secure-environment"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#prepare-a-secure-environment"}},[a._v("#")]),a._v(" Prepare a Secure Environment")]),a._v(" "),e("p",[a._v("Download latest AlmaLinux live ISO from "),e("code",[a._v("https://repo.almalinux.org/")]),a._v(". Using default Gnome mini for this guide as to not have any 3rd-party binaries present (EPEL).")]),a._v(" "),e("p",[a._v("In the folder where you download the ISO, look at the "),e("code",[a._v("CHECKSUM")]),a._v(" and "),e("code",[a._v("CHECKSUM.asc")]),a._v(" files. First let's verify that it is properly signed and that its contents can be authenticated.")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" https://repo.almalinux.org/almalinux/9/live/x86_64/CHECKSUM\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" https://repo.almalinux.org/almalinux/9/live/x86_64/CHECKSUM.asc\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" https://repo.almalinux.org/almalinux/RPM-GPG-KEY-AlmaLinux-9\ngpg "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--import")]),a._v(" RPM-GPG-KEY-AlmaLinux-9\ngpg "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--verify")]),a._v(" CHECKSUM.asc CHECKSUM\n")])])]),e("p",[a._v("Now verify the downloaded ISO's sha256 checksum against that contained in the "),e("code",[a._v("CHECKSUM")]),a._v(" file.")]),a._v(" "),e("p",[a._v("Copy the ISO file to a flash drive.")]),a._v(" "),e("p",[e("code",[a._v("dd if=almalinux.iso of=/dev/sdX")])]),a._v(" "),e("p",[a._v("Boot the image. Connect to the internet temporarily to run a single command:")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" dnf "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" epel-release words\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" dnf "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" pesign yubikey-manager yubico-piv-tool\n")])])]),e("h4",{attrs:{id:"download-gpg-public-keys-of-recipients"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#download-gpg-public-keys-of-recipients"}},[a._v("#")]),a._v(" Download GPG Public Keys of Recipients")]),a._v(" "),e("p",[a._v("If you are doing key exports as part of this, grab the public keys of all recipients.")]),a._v(" "),e("p",[a._v("These keys are accurate at the time of this writing. Verify them prior to use, of course.")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("key"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" gpg "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--import")]),a._v("\n")])])]),e("p",[e("strong",[a._v("Disconnect from the internet and do not connect again. Everything from here on out has to be done fully air-gapped and the generated private keys can never be connected to a machine with network access.")])]),a._v(" "),e("h3",{attrs:{id:"generate-keys-and-certificates"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#generate-keys-and-certificates"}},[a._v("#")]),a._v(" Generate Keys and Certificates")]),a._v(" "),e("ol",[e("li",[e("p",[a._v("First, create temporary directory and initialize NSS DB inside. Don't set password because of pesign bug.")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-m")]),a._v(" 0700 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" ~/almalinux-uefi-certs/ca\ncertutil "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" ~/almalinux-uefi-certs/ca "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-N")]),a._v("\n")])])])]),a._v(" "),e("li",[e("p",[a._v("Generate a 10 years CA certificate. More than 10 years cert is not allowed for shim:")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("efikeygen "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" ~/almalinux-uefi-certs/ca "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--ca")]),a._v(" --self-sign --not-valid-after"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("date")]),a._v(" +%s "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--date")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v("'+10 years'")]),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--nickname")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v("'AlmaLinux Secure Boot CA'")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  --common-name"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v("'CN=AlmaLinux Secure Boot CA,O=AlmaLinux OS Foundation,E=security@almalinux.org'")]),a._v("\n")])])])]),a._v(" "),e("li",[e("p",[a._v("Generate a 10 years Signing certificate. More than 10 years cert is not allowed for shim:")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("efikeygen "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" ~/almalinux-uefi-certs/ca "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--kernel")]),a._v(" --not-valid-after"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("date")]),a._v(" +%s "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--date")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v("'+10 years'")]),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--signer")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v("'AlmaLinux Secure Boot CA'")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--nickname")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v("'AlmaLinux Secure Boot Signing'")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  --common-name"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v("'CN=AlmaLinux Secure Boot Signing,O=AlmaLinux OS Foundation,E=security@almalinux.com'")]),a._v("\n")])])])]),a._v(" "),e("li",[e("p",[a._v("Export CA and Signing public and private keys to PKCS#12 files. At this point set a password, and we will store it in Vaultwarden with key holders having access:")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("pk12util "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" ~/almalinux-uefi-certs/ca "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" almalinux-secureboot-ca.p12 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-n")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v("'AlmaLinux Secure Boot CA'")]),a._v("\npk12util "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" ~/almalinux-uefi-certs/ca "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" almalinux-secureboot-signing.p12 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-n")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v("'AlmaLinux Secure Boot Signing'")]),a._v("\n")])])]),e("ul",[e("li",[e("strong",[a._v("almalinux-secureboot-ca.p12")]),a._v(" file is CA keypair that should be stored. It will be required to issue new Signing keys")]),a._v(" "),e("li",[e("strong",[a._v("almalinux-secureboot-signing.p12")]),a._v(" file is Signing keypair that should be imported to signing node to perform actual binaries signing")])])]),a._v(" "),e("li",[e("p",[a._v("Export CA and Signing public keys to DER files. No password required:")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("certutil "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" ~/almalinux-uefi-certs/ca "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-L")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-n")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"AlmaLinux Secure Boot CA"')]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-r")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" almalinux-secureboot-ca.cer\ncertutil "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" ~/almalinux-uefi-certs/ca "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-L")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-n")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"AlmaLinux Secure Boot Signing"')]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-r")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" almalinux-secureboot.cer\n")])])]),e("ul",[e("li",[e("strong",[a._v("almalinux-secureboot-ca.cer")]),a._v(" file is the CA public key we should include into shim. It also should be imported to signing node to perform actual binaries signing.")]),a._v(" "),e("li",[e("strong",[a._v("almalinux-secureboot.cer")]),a._v(" is Signing public key that may be recommended to include into some RPM packages (but not necessary)")])])])]),a._v(" "),e("h3",{attrs:{id:"configure-yubikey-piv"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#configure-yubikey-piv"}},[a._v("#")]),a._v(" Configure Yubikey PIV")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# does the system see the key")]),a._v("\nykman piv info\n")])])]),e("p",[a._v("Generate PIV Pins (only if new yubikey)")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("PIVPIN")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("awk")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v("'/^\\w{6,8}$/'")]),a._v(" /usr/share/dict/words "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("shuf")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-n1")]),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("PIVPUK")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),a._v("openssl rand "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-base64")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("10")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("tr")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" +/"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("cut")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-c")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("-8"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"PIV PIN: '),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$PIVPIN")]),a._v("; PIV PUK: "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$PIVPUK")]),a._v('"')]),a._v("\n")])])]),e("p",[e("strong",[a._v("Make sure to securely store the PIN and PUK. They are specific to the PIV component of the Yubikey.")])]),a._v(" "),e("p",[a._v("Increase PIN/PUK retry limit (only if new yubikey)")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("ykman piv access set-retries "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("9")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("9")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--pin")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("123456")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--force")]),a._v("\n")])])]),e("p",[a._v("Set our new pins (only if new yubikey)")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("ykman piv access change-pin "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--pin")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("123456")]),a._v(" --new-pin "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$PIVPIN")]),a._v("\nykman piv access change-puk "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--puk")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("12345678")]),a._v(" --new-puk "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$PIVPUK")]),a._v("\n")])])]),e("p",[a._v("Set a non-default management key (only if new yubikey)")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("ykman piv access change-management-key "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--algorithm")]),a._v(" aes128 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--protect")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--pin")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$PIVPIN")]),a._v("\n")])])]),e("p",[a._v("Import keys to Yubikey PIV slots (pay attention to slot number, 82 in this example, if not a new yubikey)")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("ykman piv keys "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("import")]),a._v(" --pin-policy always --touch-policy never "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--pin")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$PIVPIN")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("82")]),a._v(" almalinux-secureboot-signing.p12\n")])])]),e("p",[a._v("Import certificate to Yubikey PIV slots (pay attention to slot number, 82 in this example, if not a new yubikey)")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("ykman piv certificates "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("import")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--pin")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$PIVPIN")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--verify")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("82")]),a._v(" almalinux-secureboot.cer\n")])])]),e("h3",{attrs:{id:"copy-keys-and-certificates"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#copy-keys-and-certificates"}},[a._v("#")]),a._v(" Copy Keys and Certificates")]),a._v(" "),e("p",[a._v("DO NOT DO NOT DO NOT connect to the internet to copy the files.")]),a._v(" "),e("h4",{attrs:{id:"public-certificates"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#public-certificates"}},[a._v("#")]),a._v(" Public Certificates")]),a._v(" "),e("p",[a._v("Copy the .cer (public) files to a blank flash drive. This drive can then be connected to a machine with networking and distributed as necessary - there is nothing secret about them.")]),a._v(" "),e("h4",{attrs:{id:"private-keys"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#private-keys"}},[a._v("#")]),a._v(" Private Keys")]),a._v(" "),e("p",[a._v("Encrypt the private keys using GPG. The GPG-encrypted files are the only ones that can be distributed to key holders via offline methods. It's recommended that they keys remain encrypted at rest.")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("gpg "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-r")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("recipient-gpg-email"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-r")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("recipient-gpg-email"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" almalinux-secureboot-ca.p12\ngpg "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-r")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("recipient-gpg-email"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-r")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("recipient-gpg-email"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" almalinux-secureboot-signing.p12\n")])])]),e("p",[a._v("Copy the .p12 (private) keys and GPG-encrypted versions to a blank flash drive. The drive must never be connected to a networked or untrusted system. It should only ever be connected to an air-gapped blank OS install.")]),a._v(" "),e("h2",{attrs:{id:"removal-of-custodianship"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#removal-of-custodianship"}},[a._v("#")]),a._v(" Removal of Custodianship")]),a._v(" "),e("p",[a._v("We need to define how we handle if a keyholder leaves AlmaLinux.")]),a._v(" "),e("h2",{attrs:{id:"distribution-of-keys-to-key-holders"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#distribution-of-keys-to-key-holders"}},[a._v("#")]),a._v(" Distribution of Keys to Key Holders")]),a._v(" "),e("p",[a._v("Keys will be distributed to key holders only via physical medium - never via the internet. Our SOP is for the key generator to encrypt the keys with GPG and place them on a hardware-encrypted (FIPS-140 certified), self-destructing (if brute force or disassembly are attempted) USB key. These may then be mailed to the key holder or delivered in person at, for example, a conference.")]),a._v(" "),e("p",[a._v("The unlock code for the flash drive will be provided by the key generator to the key holder upon their recipient of the flash drive, and confirmation of that receipt via a GPG-signed email.")]),a._v(" "),e("p",[a._v("The hardware unlock code may be provided via the internet using encrypted means - either AlmaLinux's internal password manager (Vaultwarden) or GPG-encrypted email.")]),a._v(" "),e("h2",{attrs:{id:"storage-of-keys-by-key-holders"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#storage-of-keys-by-key-holders"}},[a._v("#")]),a._v(" Storage of Keys by Key Holders")]),a._v(" "),e("p",[a._v("Keys should be stored offline and encrypted at rest via GPG and the hardware encryption of the flash drive. It should be stored in a fire resistant lock box/safe or bank safety deposit box.")]),a._v(" "),e("h2",{attrs:{id:"key-generation-log"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#key-generation-log"}},[a._v("#")]),a._v(" Key Generation Log")]),a._v(" "),e("h3",{attrs:{id:"shim-15-8"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#shim-15-8"}},[a._v("#")]),a._v(" Shim 15.8")]),a._v(" "),e("p",[a._v("Secure boot keys generated on 2024-03-13 using policy dated 2024-03-13. These keys and certs will go into use in late 2024 and are valid through 2034.")]),a._v(" "),e("ul",[e("li",[a._v("https://github.com/rhboot/shim-review/issues/407")]),a._v(" "),e("li",[a._v("https://github.com/rhboot/shim-review/issues/432")])]),a._v(" "),e("h2",{attrs:{id:"changelog"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#changelog"}},[a._v("#")]),a._v(" Changelog")]),a._v(" "),e("h3",{attrs:{id:"_2025-01-13"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2025-01-13"}},[a._v("#")]),a._v(" 2025-01-13")]),a._v(" "),e("p",[a._v("Add Yubikey PIV certificate (public) programming instructions")]),a._v(" "),e("h3",{attrs:{id:"_2024-07-03"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2024-07-03"}},[a._v("#")]),a._v(" 2024-07-03")]),a._v(" "),e("p",[a._v("Add Yubikey PIV programming instructions")]),a._v(" "),e("h3",{attrs:{id:"_2024-03-13"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2024-03-13"}},[a._v("#")]),a._v(" 2024-03-13")]),a._v(" "),e("p",[a._v("Initial ratification")])])}),[],!1,null,null,null);e.default=r.exports}}]);