(window.webpackJsonp=window.webpackJsonp||[]).push([[70],{383:function(t,s,a){"use strict";a.r(s);var n=a(27),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"how-to-use-ec2-instance-connect"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#how-to-use-ec2-instance-connect"}},[t._v("#")]),t._v(" How to use EC2 Instance Connect")]),t._v(" "),s("h2",{attrs:{id:"about-ec2-instance-connect"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#about-ec2-instance-connect"}},[t._v("#")]),t._v(" About EC2 Instance Connect")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/connect-linux-inst-eic.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Amazon EC2 Instance Connect"),s("OutboundLink")],1),t._v(" provides a simple and secure way to connect to your Linux instances with Secure Shell (SSH).")]),t._v(" "),s("p",[t._v("If you want to connect to an AlmaLinux OS instance using EC2 Instance Connect, please, follow the steps below.")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),s("p",[t._v("EC2 Instance Connect packages are pre-installed in AlmaLinux OS starting versions "),s("code",[t._v("8.9.20240303")]),t._v(" and "),s("code",[t._v("9.3.20240303")]),t._v(" However, for older versions of AlmaLinux OS AMIs, you will need to install the packages manually:\nInstall EC2 Instance Connect RPM packages:")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("AlmaLinux OS 9 x86_64")]),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("dnf "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-y")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    https://amazon-ec2-instance-connect-us-west-2.s3.us-west-2.amazonaws.com/latest/linux_amd64/ec2-instance-connect.rpm "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    https://amazon-ec2-instance-connect-us-west-2.s3.us-west-2.amazonaws.com/latest/linux_amd64/ec2-instance-connect-selinux.noarch.rpm\n")])])])]),t._v(" "),s("li",[s("strong",[t._v("AlmaLinux OS 9 AArch64")]),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("dnf "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-y")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    https://amazon-ec2-instance-connect-us-west-2.s3.us-west-2.amazonaws.com/latest/linux_arm64/ec2-instance-connect.rpm "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    https://amazon-ec2-instance-connect-us-west-2.s3.us-west-2.amazonaws.com/latest/linux_amd64/ec2-instance-connect-selinux.noarch.rpm\n")])])])]),t._v(" "),s("li",[s("strong",[t._v("AlmaLinux OS 8 x86_64")]),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("dnf "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-y")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  https://amazon-ec2-instance-connect-us-west-2.s3.us-west-2.amazonaws.com/latest/linux_amd64/ec2-instance-connect.rhel8.rpm "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  https://amazon-ec2-instance-connect-us-west-2.s3.us-west-2.amazonaws.com/latest/linux_amd64/ec2-instance-connect-selinux.noarch.rpm\n")])])])]),t._v(" "),s("li",[s("strong",[t._v("AlmaLinux OS 8 AArch64")]),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("dnf "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-y")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  https://amazon-ec2-instance-connect-us-west-2.s3.us-west-2.amazonaws.com/latest/linux_arm64/ec2-instance-connect.rhel8.rpm "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  https://amazon-ec2-instance-connect-us-west-2.s3.us-west-2.amazonaws.com/latest/linux_amd64/ec2-instance-connect-selinux.noarch.rpm\n")])])])])])]),t._v(" "),s("h2",{attrs:{id:"enabling-ec2-instance-connect"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#enabling-ec2-instance-connect"}},[t._v("#")]),t._v(" Enabling EC2 Instance Connect")]),t._v(" "),s("p",[t._v("To be able to connect to an AlmaLinux OS instance using the EC2 Instance Connect you need to enable it first by instance ID or resource tag. For this purpose, you need to create a relevant policy file using EC2 Console or AWS CLI.")]),t._v(" "),s("h3",{attrs:{id:"ec2-console"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ec2-console"}},[t._v("#")]),t._v(" EC2 Console:")]),t._v(" "),s("ul",[s("li",[t._v("In EC2 Console navigate to "),s("strong",[t._v('"IAM -> Policies -> Create policy"')]),t._v(".")]),t._v(" "),s("li",[t._v("Select Policy editor as JSON and paste the relevant policy contents:\n"),s("ul",[s("li",[s("p",[t._v("Policy to enable EC2 Instance Connect by tag: "),s("code",[t._v("ec2_instance_connect_policy_by_tag.json")]),t._v(".")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Version"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2012-10-17"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Statement"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Effect"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Allow"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Action"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ec2-instance-connect:SendSSHPublicKey"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Resource"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"arn:aws:ec2:$REGION:$ACCOUNT-ID:instance/*"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Condition"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"StringEquals"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"aws:ResourceTag/$TAGKEY"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"$TAGVALUE"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"ec2:osuser"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ec2-user"')]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Effect"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Allow"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Action"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ec2:DescribeInstances"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Resource"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("Replace these variables with yours:")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("$REGION")]),t._v(": AWS Region of instances you want to connect (for example,"),s("code",[t._v("us-east-1")]),t._v(") or "),s("code",[t._v("*")]),t._v(" to apply to all regions.")]),t._v(" "),s("li",[s("code",[t._v("$ACCOUNT-ID")]),t._v(": ID of AWS account or "),s("code",[t._v("*")]),t._v(" to apply to all accounts.")]),t._v(" "),s("li",[s("code",[t._v("$TAGKEY")]),t._v(": Key of the resource tag, for example, "),s("code",[t._v("Foo")])]),t._v(" "),s("li",[s("code",[t._v("$TAGVALUE")]),t._v(": Value for "),s("code",[t._v("$TAGKEY")]),t._v(", for example, "),s("code",[t._v("Bar")])])])]),t._v(" "),s("li",[s("p",[t._v("Policy to enable EC2 Instance Connect by instance ID: "),s("code",[t._v("ec2_instance_connect_policy_by_instance-id.json")]),t._v(".")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Version"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2012-10-17"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Statement"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Effect"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Allow"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Action"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ec2-instance-connect:SendSSHPublicKey"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Resource"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"arn:aws:ec2:$REGION:$ACCOUNT-ID:instance/$INSTANCE-ID"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"arn:aws:ec2:$REGION:$ACCOUNT-ID:instance/$INSTANCE-ID"')]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Condition"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"StringEquals"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"ec2:osuser"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ec2-user"')]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Effect"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Allow"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Action"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ec2:DescribeInstances"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Resource"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("Replace these variables with yours:")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("$REGION")]),t._v(": AWS Region of instances you want to connect (for example,"),s("code",[t._v("us-east-1")]),t._v(") or "),s("code",[t._v("*")]),t._v(" to apply to all regions.")]),t._v(" "),s("li",[s("code",[t._v("$ACCOUNT-ID")]),t._v(": ID of AWS account or "),s("code",[t._v("*")]),t._v(" to apply to all accounts.")]),t._v(" "),s("li",[s("code",[t._v("$INSTANCE-ID")]),t._v(": ID of instance, for example, "),s("code",[t._v("i-1234567890abcdef0")])])])])])])]),t._v(" "),s("h3",{attrs:{id:"aws-cli"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#aws-cli"}},[t._v("#")]),t._v(" AWS CLI")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("Run the following command in AWS CLI to create a policy:")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("aws iam create-policy "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --policy-name "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$POLICY_NAME")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --policy-document file://"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$POLICY_FILE")]),t._v("\n")])])]),s("p",[t._v("Replace these variables with your data:")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("$POLICY_NAME")]),t._v(": Name of policy, "),s("code",[t._v("ec2_instance_connect_policy_by_instance-id")]),t._v(" or "),s("code",[t._v("ec2_instance_connect_policy_by_tag")])]),t._v(" "),s("li",[s("code",[t._v("$POLICY_FILE:")]),t._v(": Policy file in JSON "),s("code",[t._v("ec2_instance_connect_policy_by_instance-id.json")]),t._v(" or "),s("code",[t._v("ec2_instance_connect_policy_by_tag.json")])])])]),t._v(" "),s("li",[s("p",[t._v("Put relevant policy contents:")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("Policy to enable EC2 Instance Connect by tag: "),s("code",[t._v("ec2_instance_connect_policy_by_tag.json")]),t._v(".")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Version"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2012-10-17"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Statement"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Effect"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Allow"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Action"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ec2-instance-connect:SendSSHPublicKey"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Resource"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"arn:aws:ec2:$REGION:$ACCOUNT-ID:instance/*"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Condition"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"StringEquals"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"aws:ResourceTag/$TAGKEY"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"$TAGVALUE"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"ec2:osuser"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ec2-user"')]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Effect"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Allow"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Action"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ec2:DescribeInstances"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Resource"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("Replace these variables with yours:")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("$REGION")]),t._v(": AWS Region of instances you want to connect (for example,"),s("code",[t._v("us-east-1")]),t._v(") or "),s("code",[t._v("*")]),t._v(" to apply to all regions.")]),t._v(" "),s("li",[s("code",[t._v("$ACCOUNT-ID")]),t._v(": ID of AWS account or "),s("code",[t._v("*")]),t._v(" to apply to all accounts.")]),t._v(" "),s("li",[s("code",[t._v("$TAGKEY")]),t._v(": Key of the resource tag, for example, "),s("code",[t._v("Foo")])]),t._v(" "),s("li",[s("code",[t._v("$TAGVALUE")]),t._v(": Value for "),s("code",[t._v("$TAGKEY")]),t._v(", for example, "),s("code",[t._v("Bar")])])])]),t._v(" "),s("li",[s("p",[t._v("Policy to enable EC2 Instance Connect by instance ID: "),s("code",[t._v("ec2_instance_connect_policy_by_instance-id.json")]),t._v(".")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Version"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2012-10-17"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Statement"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Effect"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Allow"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Action"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ec2-instance-connect:SendSSHPublicKey"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Resource"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"arn:aws:ec2:$REGION:$ACCOUNT-ID:instance/$INSTANCE-ID"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"arn:aws:ec2:$REGION:$ACCOUNT-ID:instance/$INSTANCE-ID"')]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Condition"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"StringEquals"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"ec2:osuser"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ec2-user"')]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Effect"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Allow"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Action"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ec2:DescribeInstances"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Resource"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("Replace these variables with yours:")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("$REGION")]),t._v(": AWS Region of instances you want to connect (for example,"),s("code",[t._v("us-east-1")]),t._v(") or "),s("code",[t._v("*")]),t._v(" to apply to all regions.")]),t._v(" "),s("li",[s("code",[t._v("$ACCOUNT-ID")]),t._v(": ID of AWS account or "),s("code",[t._v("*")]),t._v(" to apply to all accounts.")]),t._v(" "),s("li",[s("code",[t._v("$INSTANCE-ID")]),t._v(": ID of instance, for example, "),s("code",[t._v("i-1234567890abcdef0")])])])])])]),t._v(" "),s("li",[s("p",[t._v("When the policy is created, you can attach this policy to an IAM user or/and group.")])])]),t._v(" "),s("h2",{attrs:{id:"connect-to-an-instance"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#connect-to-an-instance"}},[t._v("#")]),t._v(" Connect to an instance")]),t._v(" "),s("p",[t._v("There are three ways of connecting:")]),t._v(" "),s("ul",[s("li",[t._v("Use the browser-based client on the AWS Console")]),t._v(" "),s("li",[t._v("Push your public SSH keys with AWS CLI and use your SSH client to connect")]),t._v(" "),s("li",[t._v("Use AWS CLI to connect")])]),t._v(" "),s("h3",{attrs:{id:"using-the-browser-based-client-on-aws-console"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#using-the-browser-based-client-on-aws-console"}},[t._v("#")]),t._v(" Using the browser-based client on AWS Console")]),t._v(" "),s("p",[s("strong",[t._v("Requirements:")])]),t._v(" "),s("ul",[s("li",[s("code",[t._v("curl")])]),t._v(" "),s("li",[s("code",[t._v("jq")])])]),t._v(" "),s("p",[t._v("To connect using the EC2 Instance Connect browser-based client, you need to get the IP address range of the AWS service in your region. Add these ranges to the security group of instances for inbound SSH connection.")]),t._v(" "),s("p",[t._v("Get the subnet of AWS service for your region:")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-s")]),t._v(" https://ip-ranges.amazonaws.com/ip-ranges.json "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" jq "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'.prefixes[] | select(.region=="$REGION") | select(.service=="EC2_INSTANCE_CONNECT") | .ip_prefix\'')]),t._v("\n")])])]),s("p",[t._v("Replace "),s("code",[t._v("$REGION")]),t._v(" with an AWS region, for example, "),s("code",[t._v("us-east-1")])]),t._v(" "),s("h3",{attrs:{id:"push-inject-your-public-ssh-keys-with-aws-cli-and-use-ssh-client-of-your-choice"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#push-inject-your-public-ssh-keys-with-aws-cli-and-use-ssh-client-of-your-choice"}},[t._v("#")]),t._v(" Push/Inject your public SSH keys with AWS CLI and use SSH client of your choice")]),t._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),s("p",[t._v("When you connect to an instance using EC2 Instance Connect, the Instance Connect API pushes an SSH public key to the instance metadata where it remains for "),s("strong",[t._v("60 seconds")]),t._v(".")])]),t._v(" "),s("p",[t._v("Push your public SSH key to an instance and connect with the SSH client:")]),t._v(" "),s("p",[t._v("Run the command:")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("aws ec2-instance-connect send-ssh-public-key "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --instance-id "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$INSTANCE_ID")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --instance-os-user ec2-user "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --ssh-public-key file://"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$SSH_PUB_KEY_PATH")]),t._v("\n")])])]),s("p",[t._v("Replace these variables with your own:")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("$INSTANCE_ID")]),t._v(": ID of Instance, for example, "),s("code",[t._v("i-1234567890abcdef0")])]),t._v(" "),s("li",[s("code",[t._v("$SSH_PUB_KEY_PATH")]),t._v(": Path of public pair of SSH key, for example, "),s("code",[t._v("~/.ssh/my_ssh_key.pub")])])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),s("p",[t._v("See the "),s("a",{attrs:{href:"https://awscli.amazonaws.com/v2/documentation/api/latest/reference/ec2-instance-connect/send-ssh-public-key.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("AWS CLI Command Reference"),s("OutboundLink")],1),t._v(" for more command line options.")])]),t._v(" "),s("h3",{attrs:{id:"use-aws-cli-to-connect"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#use-aws-cli-to-connect"}},[t._v("#")]),t._v(" Use AWS CLI to connect")]),t._v(" "),s("p",[t._v("Run the command to connect using only AWS CLI:")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("aws ec2-instance-connect "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ssh")]),t._v(" --instance-id "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$INSTANCE_ID")]),t._v("\n")])])]),s("p",[t._v("Replace these variables with your own:")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("$INSTANCE_ID")]),t._v(": ID of Instance, for example, "),s("code",[t._v("i-1234567890abcdef0")])])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),s("p",[t._v("See the "),s("a",{attrs:{href:"https://awscli.amazonaws.com/v2/documentation/api/latest/reference/ec2-instance-connect/ssh.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("AWS CLI Command Reference"),s("OutboundLink")],1),t._v(" for more command line options.")])])])}),[],!1,null,null,null);s.default=e.exports}}]);